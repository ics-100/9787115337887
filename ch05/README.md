## 第 5 章 文件处理

**学习记录**

* `Wed Sep 16 21:32:03 CST 2020`

### 5.1 UNIX 文件的概念

> 无论UNIX文件是什么程序创建的，都可以作为连续的字节流进行访问。当你访问一个文件时，通过文件名打开它，操作系统会给你一个编号，称为`文件描述符`

**1 - 打开文件**

> * `%eax` 保存系统调用号`5`
> * `%ebx` 文件名第一个字符的地址
> * `%ecx` 以数字表示的读写 `0`读、`03101` 写
> * `%edx` 以数字表示的权限集合
> 
> Linux 将返回文件描述符到 `%eax`

**2 - 读取文件**

> * `%eax` 系统调用号`3`
> * `%ebx` 文件描述符
> * `%ecx` 缓冲区地址
> * `%edx` 缓冲区大小
> 
> 返回从文件中读取的字符数,或者一个错误代码`%eax`

**5 - 写入文件**

> * `%eax` 系统调用号`4`
> * 缓冲区应该已经填满了了要写入的数据
> 
> 把写入的字节数或错误代码存入 `%eax`

**6 - 关闭文件**

> * `%eax` 系统调用号 `6`
> * `%ebx` 文件描述符

### 5.2 缓冲区和.bss

> `缓冲区`是连续的字节块，用于批量数据传输。当你要求读取文件时，操作系统需要有一个地方来存储读取的数据，这个地方就称为缓冲区。 缓冲区的大小是固定的，由程序员设定。
> 
> `静态存储` / `动态存储`
> 
> `.bss`段类似于数据段，不同的是它不占用可执行程序空间。可以保留存储位置，却不能对其进行初始化。

```
.section .bbs
.lcomm my_buffer, 500
```

### 5.3 标准文件和特殊文件

> Linux 程序开始时至少有三个打开文件的描述符
> 
> * `STDIN` 这是`标准输入`，是一个只读文件，通常代表键盘，为文件描述符`0`
> * `STDOUT` 这是`标准输出`，是一个只写文件，通常代表屏幕显示，为文件描述符`1`
> * `STDERR` 这是`标准错误`，是一个只写文件，通常代表屏幕显示， 为文件描述符`2`

### 5.4 在程序中使用文件

> `.equ` 允许你为数字分配名称
> 
> 命令行参数以经由Linux存放在一个易于访问的位置，而且已经以空字符结束。当 Linux 程序开始时，所有指向命令行参数的指针都存存储与栈中。在C编程语言中，这称为 `argv` 数组
> 
> * 参数数目存储于`8(%ebp)`
> * 程序名存储于`12(%ebp)`
> * 参数存储于 `16(%ebp)` 及其后的存储位置